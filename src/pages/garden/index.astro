---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Badge from '../../components/Badge.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import { getCollection } from 'astro:content';

const allNotes = await getCollection('garden');

// Sort by maturity: evergreen > budding > seedling
const maturityOrder = { evergreen: 0, budding: 1, seedling: 2 };
const notes = allNotes.sort((a, b) => {
  return maturityOrder[a.data.maturity] - maturityOrder[b.data.maturity];
});

const maturityEmojis = {
  seedling: 'ðŸŒ±',
  budding: 'ðŸŒ¿',
  evergreen: 'ðŸŒ³'
};

const maturityDescriptions = {
  seedling: 'New ideas, rough notes, work in progress',
  budding: 'Developing thoughts, partially formed',
  evergreen: 'Mature, well-developed, regularly updated'
};

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', { 
    year: 'numeric', 
    month: 'short', 
    day: 'numeric' 
  });
}
---

<BaseLayout 
  title="Digital Garden | Liam Nguyen"
  description="A collection of my evolving thoughts, notes, and ideas - organized by maturity rather than date."
>
  <div class="container-custom">
    <Breadcrumb items={[
      { label: 'Home', href: '/' },
      { label: 'Garden' }
    ]} />
    
    {/* Header */}
    <header class="py-12 lg:py-16 max-w-3xl">
      <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-foreground mb-6">
        Digital Garden ðŸŒ±
      </h1>
      <p class="text-lg md:text-xl text-muted-foreground leading-relaxed mb-6">
        Welcome to my digital garden - a collection of notes, ideas, and half-formed thoughts that I'm cultivating over time. 
        Unlike a traditional blog, these notes evolve and grow.
      </p>
      <p class="text-muted-foreground">
        <a href="#about" class="text-emerald-400 hover:text-violet-300 transition-colors">Learn more about digital gardens â†’</a>
      </p>
    </header>

    {/* Maturity Legend */}
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-12">
      {(['evergreen', 'budding', 'seedling'] as const).map((maturity) => (
        <div class="card text-center">
          <div class="text-3xl mb-2">{maturityEmojis[maturity]}</div>
          <h3 class="font-semibold text-foreground capitalize mb-1">{maturity}</h3>
          <p class="text-sm text-muted-foreground">{maturityDescriptions[maturity]}</p>
        </div>
      ))}
    </div>

    {/* Notes List */}
    <section class="pb-16 lg:pb-24">
      <div class="space-y-6">
        {notes.map((note) => (
          <article class="card group">
            <div class="flex items-start gap-4">
              {/* Maturity Indicator */}
              <div class="text-2xl flex-shrink-0" title={`Maturity: ${note.data.maturity}`}>
                {maturityEmojis[note.data.maturity]}
              </div>
              
              {/* Content */}
              <div class="flex-1 min-w-0">
                <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-2 mb-2">
                  <h2 class="text-xl font-bold text-foreground group-hover:text-violet-400 transition-colors">
                    <a href={`/garden/${note.slug}`}>
                      {note.data.title}
                    </a>
                  </h2>
                  <Badge 
                    text={note.data.maturity} 
                    variant={note.data.maturity === 'evergreen' ? 'primary' : note.data.maturity === 'budding' ? 'accent' : 'default'} 
                  />
                </div>
                
                <p class="text-muted-foreground mb-3">
                  {note.data.description}
                </p>
                
                <div class="flex flex-wrap gap-2">
                  {note.data.tags.map((tag) => (
                    <span class="text-xs text-muted-foreground">#{tag}</span>
                  ))}
                </div>
              </div>
              
              {/* Arrow */}
              <div class="hidden md:flex items-center text-muted-foreground group-hover:text-violet-400 transition-colors flex-shrink-0">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </div>
            </div>
          </article>
        ))}
      </div>
      
      {notes.length === 0 && (
        <div class="text-center py-16">
          <p class="text-muted-foreground">No notes yet. Planting seeds soon!</p>
        </div>
      )}
    </section>

    {/* About Digital Gardens */}
    <section id="about" class="py-16 border-t border-white/10">
      <div class="max-w-2xl">
        <h2 class="text-2xl font-bold text-foreground mb-4">
          What is a Digital Garden?
        </h2>
        <div class="space-y-4 text-muted-foreground">
          <p>
            Unlike a traditional blog where posts are published and frozen in time, a digital garden is a space for 
            <strong class="text-foreground">growing ideas</strong>. Notes here range from rough seedlings 
            (fleeting thoughts) to budding ideas (developing concepts) to evergreen notes (well-developed, lasting content).
          </p>
          <p>
            This approach emphasizes <strong class="text-foreground">learning in public</strong> and the value of 
            sharing work at various stages of completion. It's okay for ideas to be imperfect - that's how they grow.
          </p>
          <p>
            Inspired by the works of Maggie Appleton, Andy Matuschak, and the broader digital gardening movement.
          </p>
        </div>
      </div>
    </section>
  </div>
</BaseLayout>
